import Autocomplete from"/static/fleetpings/libs/bootstrap5-autocomplete/1.1.39/autocomplete.min.js";$(document).ready(()=>{const s={prePing:$("#id_pre_ping"),formupTimeNow:$("#id_formup_now"),createSrpLink:$("#id_srp_link"),createOptimer:$("#id_optimer"),fleetSrp:$("#id_srp"),pingTarget:$("#id_ping_target"),pingChannel:$("#id_ping_channel"),fleetType:$("#id_fleet_type"),csrfToken:$('input[name="csrfmiddlewaretoken"]'),fleetComms:$("#id_fleet_comms"),fleetCommander:$("#id_fleet_commander"),fleetName:$("#id_fleet_name"),formupTime:$("#id_formup_time"),formupTimestamp:$("#id_formup_timestamp"),formupLocation:$("#id_formup_location"),fleetDoctrine:$("#id_fleet_doctrine"),fleetDoctrineUrl:$("#id_fleet_doctrine_url"),webhookEmbedColor:$("#id_webhook_embed_color")},r=(s.formupTime.datetimepicker({lang:fleetpingsSettings.dateTimeLocale,maskInput:!0,format:"Y-m-d H:i",dayOfWeekStart:1,step:15}),{sanitizeInput:e=>e&&e.replace?e.replace(/<[^>]*>/g,""):e,escapeInput:(e,t=!1)=>{if(!e)return e;const o=r.sanitizeInput(e).replace(/&/g,"&amp;");return t?o.replace(/"/g,"&quot;"):o.replace(/"/g,'\\"')},getFormupTimestamp:e=>{const t=new Date(e);return(t.getTime()-60*t.getTimezoneOffset()*1e3)/1e3},showMessage:(e,t,o="success",i=!0)=>{const s="success"===o?"alert-success":"alert-danger",r="success"===o?1e4:9999e3,n=`alert ${s} alert-dismissible alert-message-${o} align-items-center fade show`;$(t).html(`<div class="${n}">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),i&&$(`${t} > .alert-message-${o}`).fadeTo(r,500).slideUp(500,()=>{$(`${t} > .alert-message-${o}`).remove()})}}),n={loadSelectData:async(t,e)=>{try{const o=await fetchGet({url:t,responseIsJson:!1});$(e).html(o)}catch(e){console.error(`Error loading data from ${t}:`,e)}},loadAutocompleteData:async(t,e,o)=>{try{const i=await fetchGet({url:t,responseIsJson:!1});i.trim()&&n.createAutocomplete(e,o,i)}catch(e){console.error(`Error loading autocomplete data from ${t}:`,e)}},createAutocomplete:(e,t,o)=>{const i={onSelectItem:(e,t)=>{"fleet-doctrine-list"===t.e.datalist&&a.setFleetDoctrineUrl()},preventBrowserAutocomplete:!0,onRenderItem:(e,t)=>`<l-i set="fl" name="${e.value.toLowerCase()}" size="16"></l-i> ${t}`};e.after(o),new Autocomplete(document.getElementById(t),i)},initialize:async()=>{await Promise.all([n.loadSelectData(fleetpingsSettings.url.pingTargets,s.pingTarget),n.loadSelectData(fleetpingsSettings.url.pingWebhooks,s.pingChannel),n.loadSelectData(fleetpingsSettings.url.fleetTypes,s.fleetType)]),await Promise.all([n.loadAutocompleteData(fleetpingsSettings.url.formupLocations,s.formupLocation,"id_formup_location"),n.loadAutocompleteData(fleetpingsSettings.url.fleetComms,s.fleetComms,"id_fleet_comms"),n.loadAutocompleteData(fleetpingsSettings.url.fleetDoctrines,s.fleetDoctrine,"id_fleet_doctrine")])}},a={updateCheckboxVisibility:()=>{const e=s.prePing.is(":checked"),t=s.formupTimeNow.is(":checked"),o=s.fleetSrp.is(":checked");if(fleetpingsSettings.optimerInstalled&&(e?$(".fleetpings-create-optimer").show("fast"):($(".fleetpings-create-optimer").hide("fast"),s.createOptimer.prop("checked",!1))),fleetpingsSettings.srpModuleAvailableToUser){const i=t&&o;console.log(`SRP Link visibility: ${i}`),i?$(".fleetpings-create-srp-link").show("fast"):($(".fleetpings-create-srp-link").hide("fast"),s.createSrpLink.prop("checked",!1))}},setFleetDoctrineUrl:()=>{const e=r.sanitizeInput(s.fleetDoctrine.val());if(e){const t=$(`#fleet-doctrine-list [value="${r.escapeInput(e)}"]`).data("doctrine-url");s.fleetDoctrineUrl.val(t||null)}else s.fleetDoctrineUrl.val(null)},submitForm:async e=>{e.preventDefault(),$(".fleetpings-form-message div").remove();const t=(e,t)=>!e.some(e=>!e)||(r.showMessage(t,".fleetpings-form-message","error"),!1);if((!fleetpingsSettings.srpModuleAvailableToUser||!s.createSrpLink.is(":checked")||t([s.fleetName.val(),s.fleetDoctrine.val()],fleetpingsSettings.translation.srp.error.missingFields))&&(!fleetpingsSettings.optimerInstalled||!s.createOptimer.is(":checked")||t([s.fleetName.val(),s.fleetDoctrine.val(),s.formupLocation.val(),s.formupTime.val(),s.fleetCommander.val()],fleetpingsSettings.translation.optimer.error.missingFields)))try{const o=$("#aa-fleetping-form").serializeArray().reduce((e,t)=>(e[t.name]=t.value,e),{}),i=await fetchPost({url:fleetpingsSettings.url.fleetPing,csrfToken:s.csrfToken.val(),payload:o,responseIsJson:!0});i.success?($(".aa-fleetpings-no-ping").hide("fast"),$(".aa-fleetpings-ping").show("fast"),$(".aa-fleetpings-ping-text").html(i.ping_context),i.message&&r.showMessage(i.message,".fleetpings-form-message")):r.showMessage(i.message||"Something went wrong, no details given.",".fleetpings-form-message","error")}catch(e){console.error("Error:",e.message),r.showMessage(e.message||"Something went wrong, no details given.",".fleetpings-form-message","error")}}};s.pingTarget.on("change",()=>{$(".hint-ping-everyone").toggle("@everyone"===s.pingTarget.val())}),s.formupTime.on("change",()=>{const e=r.getFormupTimestamp(r.sanitizeInput(s.formupTime.val()));s.formupTimestamp.val(e)}),s.fleetType.on("change",()=>{const e=$("option:selected",s.fleetType),t=r.sanitizeInput(e.data("embed-color"))||null;s.webhookEmbedColor.val(t)}),s.prePing.on("change",()=>{const e=s.prePing.is(":checked");s.formupTimeNow.prop("checked",!e),s.formupTime.prop("disabled",!e),a.updateCheckboxVisibility()}),s.formupTimeNow.on("change",()=>{const e=s.formupTimeNow.is(":checked");s.prePing.prop("checked",!e),s.formupTime.prop("disabled",e),a.updateCheckboxVisibility()}),fleetpingsSettings.srpModuleAvailableToUser&&s.fleetSrp.on("change",a.updateCheckboxVisibility),$("form").on("submit",a.submitForm),$("#copyFleetPing").on("click",()=>{const t=new ClipboardJS("#copyFleetPing");t.on("success",e=>{r.showMessage(fleetpingsSettings.translation.copyToClipboard.success,".aa-fleetpings-ping-copyresult"),e.clearSelection(),t.destroy()}).on("error",()=>{r.showMessage(fleetpingsSettings.translation.copyToClipboard.error,".aa-fleetpings-ping-copyresult","error"),t.destroy()})}),a.updateCheckboxVisibility(),n.initialize()});
//# sourceMappingURL=fleetpings.min.js.map