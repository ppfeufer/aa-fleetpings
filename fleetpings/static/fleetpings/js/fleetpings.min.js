import Autocomplete from"/static/fleetpings/libs/bootstrap5-autocomplete/1.1.39/autocomplete.min.js";$(document).ready(()=>{const o={checkboxPrePing:$("input#id_pre_ping"),checkboxFormupTimeNow:$("input#id_formup_now"),checkboxCreateSrpLink:$("input#id_srp_link"),checkboxCreateOptimer:$("input#id_optimer"),checkboxFleetSrp:$("input#id_srp"),selectPingTarget:$("select#id_ping_target"),selectPingChannel:$("select#id_ping_channel"),selectFleetType:$("select#id_fleet_type"),inputCsrfMiddlewareToken:$('input[name="csrfmiddlewaretoken"]'),inputFleetComms:$("input#id_fleet_comms"),inputFleetCommander:$("input#id_fleet_commander"),inputFleetName:$("input#id_fleet_name"),inputFormupTime:$("input#id_formup_time"),inputFormupTimestamp:$("input#id_formup_timestamp"),inputFormupLocation:$("input#id_formup_location"),inputFleetDoctrine:$("input#id_fleet_doctrine"),inputFleetDoctrineUrl:$("input#id_fleet_doctrine_url"),inputWebhookEmbedColor:$("input#id_webhook_embed_color")},m=(o.inputFormupTime.datetimepicker({lang:fleetpingsSettings.dateTimeLocale,maskInput:!0,format:"Y-m-d H:i",dayOfWeekStart:1,step:15}),e=>e&&"object"==typeof e&&!Array.isArray(e)&&!(e instanceof Date)),i=async({url:e,method:t="get",csrfToken:s=null,payload:n=null,responseIsJson:o=!0})=>{const i=t.toLowerCase();if(!["get","post"].includes(i))throw new Error(`Invalid method: ${t}. Valid methods are: get, post`);const r={};o&&(r.Accept="application/json",r["Content-Type"]="application/json");let l=e,p=null;if("post"===i){if(!s)throw new Error("CSRF token is required for POST requests");if(r["X-CSRFToken"]=s,null!==n&&!m(n))throw new Error("Payload must be an object when using POST method");p=n?JSON.stringify(n):null}else if("get"===i&&n){const a=new URLSearchParams(n).toString();l+=(e.includes("?")?"&":"?")+a}try{const c=await fetch(l,{method:t.toUpperCase(),headers:r,body:p});if(c.ok)return o?await c.json():await c.text();throw new Error(`HTTP error! status: ${c.status}`)}catch(e){throw console.log(`Error: ${e.message}`),e}},e=({url:e,payload:t=null,responseIsJson:s=!0})=>i({url:e,method:"get",payload:t,responseIsJson:s}),r=({url:e,csrfToken:t,payload:s=null,responseIsJson:n=!0})=>i({url:e,method:"post",csrfToken:t,payload:s,responseIsJson:n}),t=()=>{e({url:fleetpingsSettings.url.pingTargets,responseIsJson:!1}).then(e=>{$(o.selectPingTarget).html(e)}).catch(e=>{console.error("Error fetching ping targets:",e)}),e({url:fleetpingsSettings.url.pingWebhooks,responseIsJson:!1}).then(e=>{$(o.selectPingChannel).html(e)}).catch(e=>{console.error("Error fetching webhooks:",e)}),e({url:fleetpingsSettings.url.fleetTypes,responseIsJson:!1}).then(e=>{$(o.selectFleetType).html(e)}).catch(e=>{console.error("Error fetching fleet types:",e)})},s=()=>{const s={onSelectItem:(e,t)=>{"fleet-doctrine-list"===t.e.datalist&&d()},preventBrowserAutocomplete:!0};e({url:fleetpingsSettings.url.formupLocations,responseIsJson:!1}).then(e=>{if(""!==e.trim()){$(o.inputFormupLocation).after(e);const t=Object.assign({},s,{onRenderItem:(e,t)=>`<l-i set="fl" name="${e.value.toLowerCase()}" size="16"></l-i> ${t}`});new Autocomplete(document.getElementById("id_formup_location"),t)}}).catch(e=>{console.error("Error fetching formup locations:",e)}),e({url:fleetpingsSettings.url.fleetComms,responseIsJson:!1}).then(e=>{if(""!==e.trim()){$(o.inputFleetComms).after(e);const t=Object.assign({},s,{onRenderItem:(e,t)=>`<l-i set="fl" name="${e.value.toLowerCase()}" size="16"></l-i> ${t}`});new Autocomplete(document.getElementById("id_fleet_comms"),t)}}).catch(e=>{console.error("Error fetching fleet comms:",e)}),e({url:fleetpingsSettings.url.fleetDoctrines,responseIsJson:!1}).then(e=>{if(""!==e.trim()){$(o.inputFleetDoctrine).after(e);const t=Object.assign({},s,{onRenderItem:(e,t)=>`<l-i set="fl" name="${e.value.toLowerCase()}" size="16"></l-i> ${t}`});new Autocomplete(document.getElementById("id_fleet_doctrine"),t)}}).catch(e=>{console.error("Error fetching fleet comms:",e)})},n=(e,t=10)=>{$(e).fadeTo(1e3*t,500).slideUp(500,()=>{$(e).remove()})},l=(e,t)=>{$(t).html(`<div class="alert alert-success alert-dismissible alert-message-success d-flex align-items-center fade show">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),n(".alert-message-success")},p=(e,t)=>{$(t).html(`<div class="alert alert-danger alert-dismissible alert-message-error d-flex align-items-center fade show">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),n(".alert-message-error",9999)},a=e=>e&&e.replace(/<(|\/|[^>/bi]|\/[^>bi]|[^/>][^>]+|\/[^>][^>]+)>/g,""),c=(t,s)=>{if(s=s||!1,t){let e=a(t).replace(/&/g,"&amp;");return!0===s&&(e=e.replace(/"/g,"&quot;")),e=!1===s?e.replace(/"/g,'\\"'):e}return t},u=e=>{const t=new Date(e);return(t.getTime()-60*t.getTimezoneOffset()*1e3)/1e3},g=()=>{const t=new ClipboardJS("button#copyFleetPing");t.on("success",e=>{l(fleetpingsSettings.translation.copyToClipboard.success,".aa-fleetpings-ping-copyresult"),e.clearSelection(),t.destroy()}),t.on("error",()=>{p(fleetpingsSettings.translation.copyToClipboard.error,".aa-fleetpings-ping-copyresult"),t.destroy()})},d=($(o.selectPingTarget).change(()=>{"@everyone"===o.selectPingTarget.val()?$(".hint-ping-everyone").show("fast"):$(".hint-ping-everyone").hide("fast")}),$(o.inputFormupTime).change(()=>{const e=u(a(o.inputFormupTime.val()));$(o.inputFormupTimestamp).val(e)}),()=>{const e=a(o.inputFleetDoctrine.val());let t=null;if(""!==e){const s=$('#fleet-doctrine-list [value="'+c(e,!1)+'"]').data("doctrine-url");"undefined"!==s&&""!==s&&(t=s)}$(o.inputFleetDoctrineUrl).val(t)});$(o.selectFleetType).change(()=>{const e=$("option:selected",o.selectFleetType);let t=null;""!==e&&(t=a(e.data("embed-color"))),$(o.inputWebhookEmbedColor).val(t)}),!0===fleetpingsSettings.srpModuleAvailableToUser&&(o.checkboxFleetSrp.is(":checked")&&o.checkboxFormupTimeNow.is(":checked")?$(".fleetpings-create-srp-link").show("fast"):(o.checkboxCreateSrpLink.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast")),o.checkboxFleetSrp.change(()=>{o.checkboxFleetSrp.is(":checked")&&o.checkboxFormupTimeNow.is(":checked")?$(".fleetpings-create-srp-link").show("fast"):(o.checkboxCreateSrpLink.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast"))})),o.checkboxPrePing.on("change",()=>{o.checkboxPrePing.is(":checked")?(o.checkboxFormupTimeNow.prop("checked",!1),o.inputFormupTime.prop("disabled",!1),!0===fleetpingsSettings.optimerInstalled&&$(".fleetpings-create-optimer").show("fast"),!0===fleetpingsSettings.srpModuleAvailableToUser&&(o.checkboxCreateSrpLink.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast"))):(o.checkboxFormupTimeNow.prop("checked",!0),o.inputFormupTime.prop("disabled",!0),!0===fleetpingsSettings.optimerInstalled&&(o.checkboxCreateOptimer.prop("checked",!1),$(".fleetpings-create-optimer").hide("fast")),!0===fleetpingsSettings.srpModuleAvailableToUser&&o.checkboxFleetSrp.is(":checked")&&$(".fleetpings-create-srp-link").show("fast"))}),o.checkboxFormupTimeNow.on("change",()=>{o.checkboxFormupTimeNow.is(":checked")?(o.checkboxPrePing.prop("checked",!1),o.inputFormupTime.prop("disabled",!0),!0===fleetpingsSettings.optimerInstalled&&(o.checkboxCreateOptimer.prop("checked",!1),$(".fleetpings-create-optimer").hide("fast")),!0===fleetpingsSettings.srpModuleAvailableToUser&&o.checkboxFleetSrp.is(":checked")&&$(".fleetpings-create-srp-link").show("fast")):(o.checkboxPrePing.prop("checked",!0),o.inputFormupTime.prop("disabled",!1),!0===fleetpingsSettings.optimerInstalled&&$(".fleetpings-create-optimer").show("fast"),!0===fleetpingsSettings.srpModuleAvailableToUser&&(o.checkboxCreateSrpLink.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast")))}),$("form").submit(e=>{if(e.preventDefault(),$(".fleetpings-form-message div").remove(),!0===fleetpingsSettings.srpModuleAvailableToUser&&o.checkboxCreateSrpLink.is(":checked")){const s=[o.inputFleetName.val(),o.inputFleetDoctrine.val()];if(s.includes(""))return p(fleetpingsSettings.translation.srp.error.missingFields,".fleetpings-form-message"),!1}if(!0===fleetpingsSettings.optimerInstalled&&o.checkboxCreateOptimer.is(":checked")){const n=[o.inputFleetName.val(),o.inputFleetDoctrine.val(),o.inputFormupLocation.val(),o.inputFormupTime.val(),o.inputFleetCommander.val()];if(n.includes(""))return p(fleetpingsSettings.translation.optimer.error.missingFields,".fleetpings-form-message"),!1}const t=$("#aa-fleetping-form").serializeArray().reduce((e,t)=>(e[t.name]=t.value,e),{});r({url:fleetpingsSettings.url.fleetPing,csrfToken:o.inputCsrfMiddlewareToken.val(),payload:t,responseIsJson:!0}).then(e=>{!0===e.success&&($(".aa-fleetpings-no-ping").hide("fast"),$(".aa-fleetpings-ping").show("fast"),$(".aa-fleetpings-ping-text").html(e.ping_context),e.message)&&l(e.message,".fleetpings-form-message")}).catch(e=>{console.error(`Error: ${e.message}`),e.message?p(e.message,".fleetpings-form-message"):p("Something went wrong, no details given.",".fleetpings-form-message")})}),$("button#copyFleetPing").on("click",()=>{g()}),t(),s()});
//# sourceMappingURL=fleetpings.min.js.map