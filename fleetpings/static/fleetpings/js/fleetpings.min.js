import Autocomplete from"/static/fleetpings/libs/bootstrap5-autocomplete/1.1.39/autocomplete.min.js";$(document).ready(()=>{const n={checkboxPrePing:$("input#id_pre_ping"),checkboxFormupTimeNow:$("input#id_formup_now"),checkboxCreateSrpLink:$("input#id_srp_link"),checkboxCreateOptimer:$("input#id_optimer"),checkboxFleetSrp:$("input#id_srp"),selectPingTarget:$("select#id_ping_target"),selectPingChannel:$("select#id_ping_channel"),selectFleetType:$("select#id_fleet_type"),inputCsrfMiddlewareToken:$('input[name="csrfmiddlewaretoken"]'),inputFleetComms:$("input#id_fleet_comms"),inputFleetCommander:$("input#id_fleet_commander"),inputFleetName:$("input#id_fleet_name"),inputFormupTime:$("input#id_formup_time"),inputFormupTimestamp:$("input#id_formup_timestamp"),inputFormupLocation:$("input#id_formup_location"),inputFleetDoctrine:$("input#id_fleet_doctrine"),inputFleetDoctrineUrl:$("input#id_fleet_doctrine_url"),inputWebhookEmbedColor:$("input#id_webhook_embed_color")},i=(n.inputFormupTime.datetimepicker({lang:fleetpingsSettings.dateTimeLocale,maskInput:!0,format:"Y-m-d H:i",dayOfWeekStart:1,step:15}),async({url:e,method:t="get",csrfToken:s=null,payload:i=null,responseIsJson:n=!0})=>{const o=t.toLowerCase();if(!["get","post"].includes(o))throw new Error(`Invalid method: ${t}. Valid methods are: get, post`);const r={};n&&(r.Accept="application/json",r["Content-Type"]="application/json");let l=e,p=null;if("post"===o){if(!s)throw new Error("CSRF token is required for POST requests");if(r["X-CSRFToken"]=s,null!==i&&!isObject(i))throw new Error("Payload must be an object when using POST method");p=i?JSON.stringify(i):null}else if("get"===o&&i){const c=new URLSearchParams(i).toString();l+=(e.includes("?")?"&":"?")+c}try{const a=await fetch(l,{method:t.toUpperCase(),headers:r,body:p});if(a.ok)return n?await a.json():await a.text();throw new Error(`HTTP error! status: ${a.status}`)}catch(e){throw console.log(`Error: ${e.message}`),e}}),e=({url:e,payload:t=null,responseIsJson:s=!0})=>i({url:e,method:"get",payload:t,responseIsJson:s}),t=()=>{e({url:fleetpingsSettings.url.pingTargets,responseIsJson:!1}).then(e=>{$(n.selectPingTarget).html(e)}).catch(e=>{console.error("Error fetching ping targets:",e)}),e({url:fleetpingsSettings.url.pingWebhooks,responseIsJson:!1}).then(e=>{$(n.selectPingChannel).html(e)}).catch(e=>{console.error("Error fetching webhooks:",e)}),e({url:fleetpingsSettings.url.fleetTypes,responseIsJson:!1}).then(e=>{$(n.selectFleetType).html(e)}).catch(e=>{console.error("Error fetching fleet types:",e)})},s=()=>{const s={onSelectItem:(e,t)=>{"fleet-doctrine-list"===t.e.datalist&&g()},preventBrowserAutocomplete:!0};e({url:fleetpingsSettings.url.formupLocations,responseIsJson:!1}).then(e=>{if(""!==e.trim()){$(n.inputFormupLocation).after(e);const t=Object.assign({},s,{onRenderItem:(e,t)=>`<l-i set="fl" name="${e.value.toLowerCase()}" size="16"></l-i> ${t}`});new Autocomplete(document.getElementById("id_formup_location"),t)}}).catch(e=>{console.error("Error fetching formup locations:",e)}),e({url:fleetpingsSettings.url.fleetComms,responseIsJson:!1}).then(e=>{if(""!==e.trim()){$(n.inputFleetComms).after(e);const t=Object.assign({},s,{onRenderItem:(e,t)=>`<l-i set="fl" name="${e.value.toLowerCase()}" size="16"></l-i> ${t}`});new Autocomplete(document.getElementById("id_fleet_comms"),t)}}).catch(e=>{console.error("Error fetching fleet comms:",e)}),e({url:fleetpingsSettings.url.fleetDoctrines,responseIsJson:!1}).then(e=>{if(""!==e.trim()){$(n.inputFleetDoctrine).after(e);const t=Object.assign({},s,{onRenderItem:(e,t)=>`<l-i set="fl" name="${e.value.toLowerCase()}" size="16"></l-i> ${t}`});new Autocomplete(document.getElementById("id_fleet_doctrine"),t)}}).catch(e=>{console.error("Error fetching fleet comms:",e)})},o=(e,t=10)=>{$(e).fadeTo(1e3*t,500).slideUp(500,()=>{$(e).remove()})},r=(e,t)=>{$(t).html(`<div class="alert alert-success alert-dismissible alert-message-success d-flex align-items-center fade show">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),o(".alert-message-success")},l=(e,t)=>{$(t).html(`<div class="alert alert-danger alert-dismissible alert-message-error d-flex align-items-center fade show">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),o(".alert-message-error",9999)},p=e=>e&&e.replace(/<(|\/|[^>/bi]|\/[^>bi]|[^/>][^>]+|\/[^>][^>]+)>/g,""),c=(t,s)=>{if(s=s||!1,t){let e=p(t).replace(/&/g,"&amp;");return!0===s&&(e=e.replace(/"/g,"&quot;")),e=!1===s?e.replace(/"/g,'\\"'):e}return t},a=e=>{const t=new Date(e);return(t.getTime()-60*t.getTimezoneOffset()*1e3)/1e3},m=()=>{const t=new ClipboardJS("button#copyFleetPing");t.on("success",e=>{r(fleetpingsSettings.translation.copyToClipboard.success,".aa-fleetpings-ping-copyresult"),e.clearSelection(),t.destroy()}),t.on("error",()=>{l(fleetpingsSettings.translation.copyToClipboard.error,".aa-fleetpings-ping-copyresult"),t.destroy()})},g=($(n.selectPingTarget).change(()=>{"@everyone"===n.selectPingTarget.val()?$(".hint-ping-everyone").show("fast"):$(".hint-ping-everyone").hide("fast")}),$(n.inputFormupTime).change(()=>{const e=a(p(n.inputFormupTime.val()));$(n.inputFormupTimestamp).val(e)}),()=>{const e=p(n.inputFleetDoctrine.val());let t=null;if(""!==e){const s=$('#fleet-doctrine-list [value="'+c(e,!1)+'"]').data("doctrine-url");"undefined"!==s&&""!==s&&(t=s)}$(n.inputFleetDoctrineUrl).val(t)});$(n.selectFleetType).change(()=>{const e=$("option:selected",n.selectFleetType);let t=null;""!==e&&(t=p(e.data("embed-color"))),$(n.inputWebhookEmbedColor).val(t)}),!0===fleetpingsSettings.srpModuleAvailableToUser&&(n.checkboxFleetSrp.is(":checked")&&n.checkboxFormupTimeNow.is(":checked")?$(".fleetpings-create-srp-link").show("fast"):(n.checkboxCreateSrpLink.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast")),n.checkboxFleetSrp.change(()=>{n.checkboxFleetSrp.is(":checked")&&n.checkboxFormupTimeNow.is(":checked")?$(".fleetpings-create-srp-link").show("fast"):(n.checkboxCreateSrpLink.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast"))})),n.checkboxPrePing.on("change",()=>{n.checkboxPrePing.is(":checked")?(n.checkboxFormupTimeNow.prop("checked",!1),n.inputFormupTime.prop("disabled",!1),!0===fleetpingsSettings.optimerInstalled&&$(".fleetpings-create-optimer").show("fast"),!0===fleetpingsSettings.srpModuleAvailableToUser&&(n.checkboxCreateSrpLink.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast"))):(n.checkboxFormupTimeNow.prop("checked",!0),n.inputFormupTime.prop("disabled",!0),!0===fleetpingsSettings.optimerInstalled&&(n.checkboxCreateOptimer.prop("checked",!1),$(".fleetpings-create-optimer").hide("fast")),!0===fleetpingsSettings.srpModuleAvailableToUser&&n.checkboxFleetSrp.is(":checked")&&$(".fleetpings-create-srp-link").show("fast"))}),n.checkboxFormupTimeNow.on("change",()=>{n.checkboxFormupTimeNow.is(":checked")?(n.checkboxPrePing.prop("checked",!1),n.inputFormupTime.prop("disabled",!0),!0===fleetpingsSettings.optimerInstalled&&(n.checkboxCreateOptimer.prop("checked",!1),$(".fleetpings-create-optimer").hide("fast")),!0===fleetpingsSettings.srpModuleAvailableToUser&&n.checkboxFleetSrp.is(":checked")&&$(".fleetpings-create-srp-link").show("fast")):(n.checkboxPrePing.prop("checked",!0),n.inputFormupTime.prop("disabled",!1),!0===fleetpingsSettings.optimerInstalled&&$(".fleetpings-create-optimer").show("fast"),!0===fleetpingsSettings.srpModuleAvailableToUser&&(n.checkboxCreateSrpLink.prop("checked",!1),$(".fleetpings-create-srp-link").hide("fast")))}),$("form").submit(e=>{if(e.preventDefault(),$(".fleetpings-form-message div").remove(),!0===fleetpingsSettings.srpModuleAvailableToUser&&n.checkboxCreateSrpLink.is(":checked")){const s=[n.inputFleetName.val(),n.inputFleetDoctrine.val()];if(s.includes(""))return l(fleetpingsSettings.translation.srp.error.missingFields,".fleetpings-form-message"),!1}if(!0===fleetpingsSettings.optimerInstalled&&n.checkboxCreateOptimer.is(":checked")){const i=[n.inputFleetName.val(),n.inputFleetDoctrine.val(),n.inputFormupLocation.val(),n.inputFormupTime.val(),n.inputFleetCommander.val()];if(i.includes(""))return l(fleetpingsSettings.translation.optimer.error.missingFields,".fleetpings-form-message"),!1}const t=$("#aa-fleetping-form").serializeArray().reduce((e,t)=>(e[t.name]=t.value,e),{});$.ajax({url:fleetpingsSettings.url.fleetPing,type:"post",data:t,headers:{"X-CSRFToken":n.inputCsrfMiddlewareToken.val()},success:e=>{!0===e.success?($(".aa-fleetpings-no-ping").hide("fast"),$(".aa-fleetpings-ping").show("fast"),$(".aa-fleetpings-ping-text").html(e.ping_context),e.message&&r(e.message,".fleetpings-form-message")):e.message?l(e.message,".fleetpings-form-message"):l("Something went wrong, no details given.",".fleetpings-form-message")}})}),$("button#copyFleetPing").on("click",()=>{m()}),t(),s()});
//# sourceMappingURL=fleetpings.min.js.map