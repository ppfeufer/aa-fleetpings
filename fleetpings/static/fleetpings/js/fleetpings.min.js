import Autocomplete from'/static/fleetpings/libs/bootstrap5-autocomplete/1.1.39/autocomplete.min.js';$(document).ready(()=>{'use strict';const e={prePing:$('#id_pre_ping'),formupTimeNow:$('#id_formup_now'),createSrpLink:$('#id_srp_link'),createOptimer:$('#id_optimer'),fleetSrp:$('#id_srp'),pingTarget:$('#id_ping_target'),pingChannel:$('#id_ping_channel'),fleetType:$('#id_fleet_type'),csrfToken:$('input[name="csrfmiddlewaretoken"]'),fleetComms:$('#id_fleet_comms'),fleetCommander:$('#id_fleet_commander'),fleetName:$('#id_fleet_name'),formupTime:$('#id_formup_time'),formupTimestamp:$('#id_formup_timestamp'),formupLocation:$('#id_formup_location'),fleetDoctrine:$('#id_fleet_doctrine'),fleetDoctrineUrl:$('#id_fleet_doctrine_url'),webhookEmbedColor:$('#id_webhook_embed_color')};e.formupTime.datetimepicker({lang:fleetpingsSettings.dateTimeLocale,maskInput:!0,format:'Y-m-d H:i',dayOfWeekStart:1,step:15});const t={sanitizeInput:e=>e&&e.replace?e.replace(/<[^>]*>/g,''):e,escapeInput:(e,o=!1)=>{if(!e)return e;const i=t.sanitizeInput(e).replace(/&/g,'&amp;');return o?i.replace(/"/g,'&quot;'):i.replace(/"/g,'\\"')},getFormupTimestamp:e=>{const t=new Date(e);return(t.getTime()-60*t.getTimezoneOffset()*1e3)/1e3},showMessage:(e,t,o='success',i=!0)=>{const s='success'===o?1e4:9999e3,r=`alert ${'success'===o?'alert-success':'alert-danger'} alert-dismissible alert-message-${o} align-items-center fade show`;$(t).html(`<div class="${r}">${e}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>`),i&&$(`${t} > .alert-message-${o}`).fadeTo(s,500).slideUp(500,()=>{$(`${t} > .alert-message-${o}`).remove()})}},o={loadSelectData:async(e,t)=>{try{const o=await fetchGet({url:e,responseIsJson:!1});$(t).html(o)}catch(t){console.error(`Error loading data from ${e}:`,t)}},loadAutocompleteData:async(e,t,i)=>{try{const s=await fetchGet({url:e,responseIsJson:!1});s.trim()&&o.createAutocomplete(t,i,s)}catch(t){console.error(`Error loading autocomplete data from ${e}:`,t)}},createAutocomplete:(e,t,o)=>{const s={onSelectItem:(e,t)=>{'fleet-doctrine-list'===t.e.datalist&&i.setFleetDoctrineUrl()},preventBrowserAutocomplete:!0,onRenderItem:(e,t)=>`<l-i set="fl" name="${e.value.toLowerCase()}" size="16"></l-i> ${t}`};e.after(o);new Autocomplete(document.getElementById(t),s)},initialize:async()=>{await Promise.all([o.loadSelectData(fleetpingsSettings.url.pingTargets,e.pingTarget),o.loadSelectData(fleetpingsSettings.url.pingWebhooks,e.pingChannel),o.loadSelectData(fleetpingsSettings.url.fleetTypes,e.fleetType)]),await Promise.all([o.loadAutocompleteData(fleetpingsSettings.url.formupLocations,e.formupLocation,'id_formup_location'),o.loadAutocompleteData(fleetpingsSettings.url.fleetComms,e.fleetComms,'id_fleet_comms'),o.loadAutocompleteData(fleetpingsSettings.url.fleetDoctrines,e.fleetDoctrine,'id_fleet_doctrine')])}},i={updateCheckboxVisibility:()=>{const t=e.prePing.is(':checked'),o=e.formupTimeNow.is(':checked'),i=e.fleetSrp.is(':checked');if(fleetpingsSettings.optimerInstalled&&(t?$('.fleetpings-create-optimer').show('fast'):($('.fleetpings-create-optimer').hide('fast'),e.createOptimer.prop('checked',!1))),fleetpingsSettings.srpModuleAvailableToUser){const t=o&&i;console.log(`SRP Link visibility: ${t}`),t?$('.fleetpings-create-srp-link').show('fast'):($('.fleetpings-create-srp-link').hide('fast'),e.createSrpLink.prop('checked',!1))}},setFleetDoctrineUrl:()=>{const o=t.sanitizeInput(e.fleetDoctrine.val());if(!o)return void e.fleetDoctrineUrl.val(null);const i=$(`#fleet-doctrine-list [value="${t.escapeInput(o)}"]`).data('doctrine-url');e.fleetDoctrineUrl.val(i||null)},submitForm:async o=>{o.preventDefault(),$('.fleetpings-form-message div').remove();const i=(e,o)=>!e.some(e=>!e)||(t.showMessage(o,'.fleetpings-form-message','error'),!1);if((!fleetpingsSettings.srpModuleAvailableToUser||!e.createSrpLink.is(':checked')||i([e.fleetName.val(),e.fleetDoctrine.val()],fleetpingsSettings.translation.srp.error.missingFields))&&(!fleetpingsSettings.optimerInstalled||!e.createOptimer.is(':checked')||i([e.fleetName.val(),e.fleetDoctrine.val(),e.formupLocation.val(),e.formupTime.val(),e.fleetCommander.val()],fleetpingsSettings.translation.optimer.error.missingFields)))try{const o=$('#aa-fleetping-form').serializeArray().reduce((e,t)=>(e[t.name]=t.value,e),{}),i=await fetchPost({url:fleetpingsSettings.url.fleetPing,csrfToken:e.csrfToken.val(),payload:o,responseIsJson:!0});i.success?($('.aa-fleetpings-no-ping').hide('fast'),$('.aa-fleetpings-ping').show('fast'),$('.aa-fleetpings-ping-text').html(i.ping_context),i.message&&t.showMessage(i.message,'.fleetpings-form-message')):t.showMessage(i.message||'Something went wrong, no details given.','.fleetpings-form-message','error')}catch(e){console.error('Error:',e.message),t.showMessage(e.message||'Something went wrong, no details given.','.fleetpings-form-message','error')}}};e.pingTarget.on('change',()=>{$('.hint-ping-everyone').toggle('@everyone'===e.pingTarget.val())}),e.formupTime.on('change',()=>{const o=t.getFormupTimestamp(t.sanitizeInput(e.formupTime.val()));e.formupTimestamp.val(o)}),e.fleetType.on('change',()=>{const o=$('option:selected',e.fleetType),i=t.sanitizeInput(o.data('embed-color'))||null;e.webhookEmbedColor.val(i)}),e.prePing.on('change',()=>{const t=e.prePing.is(':checked');e.formupTimeNow.prop('checked',!t),e.formupTime.prop('disabled',!t),i.updateCheckboxVisibility()}),e.formupTimeNow.on('change',()=>{const t=e.formupTimeNow.is(':checked');e.prePing.prop('checked',!t),e.formupTime.prop('disabled',t),i.updateCheckboxVisibility()}),fleetpingsSettings.srpModuleAvailableToUser&&e.fleetSrp.on('change',i.updateCheckboxVisibility),$('form').on('submit',i.submitForm),$('#copyFleetPing').on('click',()=>{const e=new ClipboardJS('#copyFleetPing');e.on('success',o=>{t.showMessage(fleetpingsSettings.translation.copyToClipboard.success,'.aa-fleetpings-ping-copyresult'),o.clearSelection(),e.destroy()}).on('error',()=>{t.showMessage(fleetpingsSettings.translation.copyToClipboard.error,'.aa-fleetpings-ping-copyresult','error'),e.destroy()})}),i.updateCheckboxVisibility(),o.initialize()});
//# sourceMappingURL=fleetpings.min.js.map